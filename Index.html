<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Momentum</title>

<style>

:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --radius:18px;
  --shadow:0 4px 18px rgba(0,0,0,0.06);
  --blue:#0b69ff;
  --text:#111;
  --text-light:#667085;
  --border:#e5e7eb;
  --nav-inactive:#9ca3af;
}

*{
  margin:0;padding:0;box-sizing:border-box;
  font-family:-apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
}

html,body{
  background:var(--bg);
  height:100%;
  overflow-x:hidden;
}

/* TOP BAR */
.topbar{
  position:sticky;
  top:0;
  z-index:50;
  background:var(--bg);
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid var(--border);
}

.top-left{
  display:flex;
  align-items:center;
  gap:10px;
}

.logo{
  background:var(--blue);
  color:#fff;
  width:36px;height:36px;
  border-radius:12px;
  display:flex;justify-content:center;
  align-items:center;
  font-weight:700;
  font-size:18px;
}

.app-title{
  font-weight:700;
  font-size:18px;
  color:var(--text);
}

.app-sub{
  font-size:12px;
  color:var(--text-light);
}

.top-btn{
  padding:6px 14px;
  border:none;
  background:var(--card);
  border-radius:12px;
  box-shadow:var(--shadow);
  font-size:14px;
}

.top-right{
  display:flex;
  gap:10px;
}

/* PAGE LAYOUT */
.page{
  padding:16px;
  padding-bottom:100px;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px;
  margin-bottom:20px;
  box-shadow:var(--shadow);
}

/* SUMMARY */
.summary-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.small-label{
  font-size:13px;
  color:var(--text-light);
}

.big-time{
  font-weight:700;
  font-size:26px;
  color:var(--text);
}

.categories-row{
  margin-top:14px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}

.category-badge{
  background:#fff;
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:10px 14px;
  text-align:center;
  min-width:90px;
}

.cat-label{
  font-size:13px;
  color:var(--text-light);
}

.cat-time{
  font-size:15px;
  margin-top:4px;
  font-weight:600;
  color:var(--text);
}

/* CHARTS */
.chart-header{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

.chart-title{
  font-weight:600;
  color:var(--text);
}

.chart-action{
  font-size:13px;
  color:var(--text-light);
}

.chart-date{
  font-size:13px;
  color:var(--text-light);
}

.donut-wrapper{
  width:100%;
  max-width:260px;
  margin:auto;
  position:relative;
}

#donutChart{
  width:100%!important;
  height:auto!important;
}

.donut-center{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-weight:700;
  font-size:22px;
}

.donut-legend{
  margin-top:14px;
  display:flex;
  flex-direction:column;
  gap:8px;
  font-size:14px;
}

#lineChart{
  width:100%!important;
  height:auto!important;
}

/* RECENT */
.recent-title{
  font-weight:600;
  margin-bottom:10px;
}

.recent-item{
  padding:8px 0;
  font-size:14px;
  color:var(--text-light);
  border-bottom:1px solid var(--border);
}

/* TIMERS */
.timers-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.timers-title{
  font-weight:700;
  font-size:18px;
}

.add-btn{
  background:var(--blue);
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:12px;
}

.clear-btn{
  margin-top:16px;
  padding:12px;
  background:#eee;
  border:none;
  border-radius:12px;
  width:100%;
}

.timer-item{
  background:#fff;
  border:1px solid var(--border);
  padding:14px;
  border-radius:var(--radius);
  margin-bottom:14px;
}

.timer-title{
  font-weight:600;
  margin-bottom:4px;
}

.timer-goal{
  font-size:13px;
  color:var(--text-light);
  margin-bottom:10px;
}

.timer-row{
  display:flex;
  gap:6px;
}

.timer-btn{
  flex:1;
  padding:10px;
  border:none;
  border-radius:10px;
  background:#f3f4f6;
  font-size:14px;
}

.timer-btn.start{
  background:var(--blue);
  color:#fff;
}

/* NOTES */
.notes-date{
  font-weight:700;
  font-size:18px;
  margin-bottom:10px;
}

.notes-input{
  width:100%;
  height:110px;
  padding:12px;
  border-radius:14px;
  border:none;
  background:#f3f4f6;
  resize:none;
  font-size:15px;
}

.save-btn{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  background:var(--blue);
  color:#fff;
  border-radius:14px;
  font-size:16px;
}

.history-title{
  font-weight:700;
  margin-bottom:10px;
}

.history-entry{
  background:#fff;
  border:1px solid var(--border);
  padding:12px;
  border-radius:14px;
  margin-bottom:12px;
}

.history-date{
  font-weight:600;
  margin-bottom:4px;
}

.history-text{
  font-size:14px;
  color:var(--text-light);
}

/* FOOTER */
.footer-info{
  text-align:center;
  font-size:13px;
  color:var(--text-light);
  margin-top:10px;
}

/* NAV BAR */
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:78px;
  background:#fff;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:100;
}

.nav-btn{
  background:none;
  border:none;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
  color:var(--nav-inactive);
}

.nav-active{
  color:var(--blue)!important;
}

.nav-icon-wrap{
  width:26px;
  height:26px;
}

.nav-icon{
  width:100%;
  height:100%;
  stroke:currentColor;
  fill:none;
}

  </style>
  <body>

  <!-- HEADER -->
  <header class="topbar">
    <div class="top-left">
      <div class="logo">M</div>
      <div>
        <div class="app-title">Momentum</div>
        <div class="app-sub">Reports • Timers • Notes</div>
      </div>
    </div>

    <div class="top-right">
      <button id="exportBtn" class="top-btn">Export</button>
      <button id="importBtn" class="top-btn">Import</button>
      <input id="importInput" type="file" accept="application/json" style="display:none;">
    </div>
  </header>


  <!-- HOME PAGE -->
  <main id="page-home" class="page">

    <section class="card summary-card">
      <div class="summary-row">
        <div>
          <div class="small-label">Today’s total</div>
          <div id="todayTotal" class="big-time">0m</div>
        </div>
        <div class="streak-box">
          <div class="small-label">Streak</div>
          <div id="streakCount" class="big-time">0d</div>
        </div>
      </div>

      <div class="categories-row">
        <div class="category-badge">
          <div class="cat-label">Study</div>
          <div id="studyTotal" class="cat-time">0m</div>
        </div>
        <div class="category-badge">
          <div class="cat-label">Project</div>
          <div id="projectTotal" class="cat-time">0m</div>
        </div>
        <div class="category-badge">
          <div class="cat-label">Workout</div>
          <div id="workoutTotal" class="cat-time">0m</div>
        </div>
        <div class="category-badge">
          <div class="cat-label">Social</div>
          <div id="socialTotal" class="cat-time">0m</div>
        </div>
      </div>
    </section>


    <!-- DONUT CHART -->
    <section class="card chart-block">
      <div class="chart-header">
        <span class="chart-title">Daily Distribution</span>
        <span class="chart-action">Breakdown</span>
      </div>

      <div class="donut-wrapper">
        <canvas id="donutChart"></canvas>
        <div id="donutCenter" class="donut-center">0h</div>
      </div>

      <div id="donutLegend" class="donut-legend"></div>
    </section>


    <!-- LINE CHART -->
    <section class="card chart-block">
      <div class="chart-header">
        <span class="chart-title">Weekly Trend</span>
        <span class="chart-date" id="trendDateRange"></span>
      </div>

      <canvas id="lineChart"></canvas>
    </section>


    <!-- RECENT SESSIONS -->
    <section class="card recent-card">
      <div class="recent-title">Recent sessions</div>
      <div id="recentSessions" class="recent-list"></div>
    </section>


    <div class="footer-info">Offline • Single file • LocalStorage</div>
  </main>



  <!-- TIMERS PAGE -->
  <main id="page-timers" class="page" style="display:none;">

    <section class="card timers-card">
      <div class="timers-header">
        <div class="timers-title">Daily Timers</div>
        <button id="addCategoryBtn" class="add-btn">+ Add</button>
      </div>

      <div id="timersList"></div>

      <button id="clearTodayBtn" class="clear-btn">Clear Today</button>
    </section>

    <div class="footer-info">Offline • Single file • LocalStorage</div>

  </main>



  <!-- NOTES PAGE -->
  <main id="page-notes" class="page" style="display:none;">

    <section class="card notes-card">
      <div class="notes-date" id="notesTodayHeader"></div>

      <textarea id="notesInput" class="notes-input"
        placeholder="What did you achieve today?"></textarea>

      <button id="saveNotesBtn" class="save-btn">Save</button>
    </section>


    <section class="card notes-history-card">
      <div class="history-title">Previous Notes</div>
      <div id="notesHistory"></div>
    </section>

    <div class="footer-info">Offline • Single file • LocalStorage</div>

  </main>



  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">

    <button class="nav-btn nav-active" data-page="page-home">
      <div class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" class="nav-icon">
          <path d="M12 3L3 10h3v8h12v-8h3z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <span>Home</span>
    </button>

    <button class="nav-btn" data-page="page-timers">
      <div class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" class="nav-icon">
          <circle cx="12" cy="12" r="8" stroke-width="2"/>
          <path d="M12 8v4l3 2" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <span>Timers</span>
    </button>

    <button class="nav-btn" data-page="page-notes">
      <div class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" class="nav-icon">
          <path d="M4 4h16v14H4z" stroke-width="2"/>
          <path d="M8 8h8M8 12h5" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <span>Notes</span>
    </button>

  </nav>
  <script>

// -----------------------------
// SAFE STATE INIT
// -----------------------------
let data = JSON.parse(localStorage.getItem("momentum-data") || "{}");

if (!data.timers) {
  data.timers = {
    study:   { goal:360, sessions:[] },
    project: { goal:240, sessions:[] },
    workout: { goal:60,  sessions:[] },
    social:  { goal:30,  sessions:[] }
  };
}

if (!data.notes) data.notes = {};
if (!data.streak) data.streak = 0;

saveState();
function saveState(){
  localStorage.setItem("momentum-data", JSON.stringify(data));
}


// -----------------------------
// HELPERS
// -----------------------------
function todayKey(){ return new Date().toISOString().slice(0,10); }
function nowMinutes(){ return Math.floor(Date.now()/60000); }

function fmt(mins){
  if (mins <= 0) return "0m";
  let h = Math.floor(mins / 60);
  let m = mins % 60;
  return h > 0 ? `${h}h ${m}m` : `${m}m`;
}


// -----------------------------
// NAVIGATION
// -----------------------------
const pages = document.querySelectorAll(".page");
const navBtns = document.querySelectorAll(".nav-btn");

navBtns.forEach(btn=>{
  btn.onclick = () => {
    let target = btn.dataset.page;

    navBtns.forEach(b=>b.classList.remove("nav-active"));
    btn.classList.add("nav-active");

    pages.forEach(p=>p.style.display="none");
    document.getElementById(target).style.display="block";

    if(target==="page-home") renderHome();
    if(target==="page-timers") renderTimers();
    if(target==="page-notes") renderNotes();
  };
});


// -----------------------------
// HOME PAGE
// -----------------------------
let donutChart, lineChart;

function renderHome(){
  let t = todayKey();
  let totals = { study:0, project:0, workout:0, social:0 };
  let recent = [];

  for (let k in data.timers){
    for (let s of data.timers[k].sessions){
      if(s.date === t){
        totals[k] += s.mins;
        recent.push({...s, cat:k});
      }
    }
  }

  document.getElementById("todayTotal").innerText = fmt(
    totals.study + totals.project + totals.workout + totals.social
  );
  document.getElementById("studyTotal").innerText   = fmt(totals.study);
  document.getElementById("projectTotal").innerText = fmt(totals.project);
  document.getElementById("workoutTotal").innerText = fmt(totals.workout);
  document.getElementById("socialTotal").innerText  = fmt(totals.social);

  document.getElementById("streakCount").innerText = data.streak + "d";

  renderDonut(totals);
  renderWeekly();

  // recent sessions
  let wrap = document.getElementById("recentSessions");
  wrap.innerHTML = "";
  recent.slice(-8).reverse().forEach(r=>{
    let d = document.createElement("div");
    d.className = "recent-item";
    d.innerText = `${r.cat} — ${fmt(r.mins)}`;
    wrap.appendChild(d);
  });
}


// -----------------------------
// DONUT CHART
// -----------------------------
function renderDonut(totals){
  let ctx = document.getElementById("donutChart");
  let arr = [totals.study, totals.project, totals.workout, totals.social];
  let sum = arr.reduce((a,b)=>a+b,0);

  document.getElementById("donutCenter").innerText = (sum/60).toFixed(1)+"h";

  if(donutChart) donutChart.destroy();

  donutChart = new Chart(ctx,{
    type:"doughnut",
    data:{
      labels:["Study","Project","Workout","Social"],
      datasets:[{
        data:arr,
        backgroundColor:["#0ea5e9","#22c55e","#f97316","#ef4444"],
        borderWidth:0,
        cutout:"60%"
      }]
    },
    options:{ plugins:{legend:{display:false}}, responsive:true }
  });

  let legend = document.getElementById("donutLegend");
  legend.innerHTML = "";
  ["Study","Project","Workout","Social"].forEach((name,i)=>{
    let m = arr[i];
    let pct = sum?((m/sum)*100).toFixed(0):0;
    let row = document.createElement("div");
    row.innerHTML = `
      <span style="display:inline-block;width:12px;height:12px;
      background:${donutChart.data.datasets[0].backgroundColor[i]};
      border-radius:4px;margin-right:6px;"></span>
      ${name}: ${fmt(m)}  — ${pct}%`;
    legend.appendChild(row);
  });
}


// -----------------------------
// WEEKLY LINE CHART
// -----------------------------
function renderWeekly(){
  let ctx = document.getElementById("lineChart");

  let labels = [];
  let values = [];

  for(let i=6;i>=0;i--){
    let d = new Date(Date.now()-i*86400000);
    let key = d.toISOString().slice(0,10);
    labels.push(key.slice(5));

    let sum=0;
    for(let k in data.timers){
      for(let s of data.timers[k].sessions){
        if(s.date===key) sum+=s.mins;
      }
    }
    values.push((sum/60).toFixed(1));
  }

  document.getElementById("trendDateRange").innerText =
    `${labels[0]} → ${labels[6]}`;

  if(lineChart) lineChart.destroy();

  lineChart = new Chart(ctx,{
    type:"line",
    data:{
      labels:labels,
      datasets:[{
        label:"Hours",
        data:values,
        borderColor:"#0b69ff",
        backgroundColor:"rgba(11,105,255,0.2)",
        fill:true,
        tension:0.3,
        pointRadius:4
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true}}
    }
  });
}


// -----------------------------
// TIMERS PAGE
// -----------------------------
let running = {};

function renderTimers(){
  let list = document.getElementById("timersList");
  list.innerHTML = "";

  for(let cat in data.timers){
    let t = data.timers[cat];

    let div = document.createElement("div");
    div.className = "timer-item";

    div.innerHTML = `
      <div class="timer-title">${cat.charAt(0).toUpperCase()+cat.slice(1)}</div>
      <div class="timer-goal">Goal: ${fmt(t.goal)}</div>

      <div class="timer-row">
        <button class="timer-btn start" data-cat="${cat}" data-act="start">Start</button>
        <button class="timer-btn" data-cat="${cat}" data-act="stop">Stop</button>
        <button class="timer-btn" data-cat="${cat}" data-act="log">Log</button>
        <button class="timer-btn" data-cat="${cat}" data-act="delete">Del</button>
      </div>
    `;

    list.appendChild(div);
  }

  document.querySelectorAll(".timer-btn").forEach(btn=>{
    btn.onclick = ()=>{
      let cat = btn.dataset.cat;
      let act = btn.dataset.act;

      if(act==="start"){
        running[cat] = { start: nowMinutes() };
      }

      if(act==="stop"){
        if(running[cat]){
          let mins = nowMinutes() - running[cat].start;
          if(mins>0) addSession(cat, mins);
          delete running[cat];
        }
      }

      if(act==="log"){
        let m = parseInt(prompt("Minutes?")||"0");
        if(m>0) addSession(cat, m);
      }

      if(act==="delete"){
        if(confirm("Delete all sessions?")){
          data.timers[cat].sessions = [];
          saveState();
        }
      }

      renderTimers();
      renderHome();
    };
  });

  document.getElementById("clearTodayBtn").onclick = ()=>{
    let t = todayKey();
    for(let c in data.timers){
      data.timers[c].sessions = data.timers[c].sessions.filter(s=>s.date!==t);
    }
    saveState();
    renderTimers();
    renderHome();
  };
}

function addSession(cat, mins){
  let t = todayKey();
  data.timers[cat].sessions.push({date:t, mins:mins});
  saveState();
}


// -----------------------------
// NOTES PAGE
// -----------------------------
function renderNotes(){
  let t = todayKey();

  document.getElementById("notesTodayHeader").innerText = t;
  document.getElementById("notesInput").value = data.notes[t] || "";

  let history = document.getElementById("notesHistory");
  history.innerHTML = "";

  Object.keys(data.notes).sort().reverse().forEach(d=>{
    if(d===t) return;
    let box = document.createElement("div");
    box.className="history-entry";
    box.innerHTML = `
      <div class="history-date">${d}</div>
      <div class="history-text">${data.notes[d]}</div>
    `;
    history.appendChild(box);
  });

  document.getElementById("saveNotesBtn").onclick = ()=>{
    let txt = document.getElementById("notesInput").value.trim();
    if(txt.length>0) data.notes[t] = txt;
    else delete data.notes[t];

    saveState();
    renderNotes();
  };
}


// -----------------------------
// EXPORT / IMPORT
// -----------------------------
document.getElementById("exportBtn").onclick = ()=>{
  let blob = new Blob([JSON.stringify(data)], {type:"application/json"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "momentum.json";
  a.click();
};

document.getElementById("importBtn").onclick = ()=>{
  document.getElementById("importInput").click();
};

document.getElementById("importInput").onchange = e=>{
  let file = e.target.files[0];
  if(!file) return;

  let reader = new FileReader();
  reader.onload = ()=>{
    try{
      data = JSON.parse(reader.result);
      saveState();
      renderHome();
      renderTimers();
      renderNotes();
    }catch(err){
      alert("Invalid JSON");
    }
  };
  reader.readAsText(file);
};


// -----------------------------
// INITIAL LOAD
// -----------------------------
renderHome();

</script>

</body>
</html>
